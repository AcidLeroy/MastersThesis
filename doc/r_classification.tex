\chapter{\label{ap:svm_classification}R Code for SVM Classification}

\begin{minted}{r}
  ClassifyFeatures <- function(VideoHists){
    NoOfSamples <- length(VideoHists$Classification)

    # Build a factor of the correct classification:
    All_cl <- unlist(VideoHists$Classification);

    # Store 1 for wrong classification and 0 for correct.
    knnResult <- rep(1, times=NoOfSamples);
    svmResult <- rep(1, times=NoOfSamples);

    # Remove classification
    no_use = c("Filename", "Classification")
    features = GetAllExcept(VideoHists, no_use)

    # Create a leave one out classification approach
    for(i in 1:NoOfSamples)
    {
      # Set up training and testing data:
      trainData = lapply(features, function(x) x[-i]) # Remove i.
      testData  = lapply(features, function(x) x[i]) # One left out.

      #Combine data
      trainData = t(CombineFeatures(trainData, names(trainData)))
      testData = t(CombineFeatures(testData, names(testData)))

      # Prepare the labels for the training set:
      #  Optimal: k=1
      knnResult[i] <- knn (trainData, testData, All_cl[-i], k=3); # 3

      #**** With tuning ****#
      tune.out=tune(svm, trainData, All_cl[-i], , kernel="linear", ranges=list(cost=c(0.0001, 0.001, 0.01, 0.1, 1, 5, 10, 100, 10000)) , scale=FALSE)
      svmResult[i] <- predict(tune.out$best.model, testData);



      #***** Without tuning *****#
  #    model <- svm(All_cl[-i] ~ ., data=trainData, scale=FALSE);
  #    svmResult[i] <- predict(model, testData);
      cat("SVM result =  ", round(svmResult), "\n");
      cat("KNN result =  ", knnResult, "\n")

    }
\end{minted}
